From 33449eceac475f2e5b4d26fa96a026bb96bef3da Mon Sep 17 00:00:00 2001
From: "Yang,JunchaoX" <junchaox.yang@intel.com>
Date: Mon, 28 Mar 2022 20:00:30 +0800
Subject: [PATCH] not merge OAM-101262

---
 .../java/com/android/server/display/LocalDisplayAdapter.java  | 4 +++-
 services/core/java/com/android/server/wm/DisplayRotation.java | 4 ++++
 2 files changed, 7 insertions(+), 1 deletion(-)
 mode change 100644 => 100755 services/core/java/com/android/server/display/LocalDisplayAdapter.java
 mode change 100644 => 100755 services/core/java/com/android/server/wm/DisplayRotation.java

diff --git a/services/core/java/com/android/server/display/LocalDisplayAdapter.java b/services/core/java/com/android/server/display/LocalDisplayAdapter.java
old mode 100644
new mode 100755
index 2c08420af42d..31e0a4e72599
--- a/services/core/java/com/android/server/display/LocalDisplayAdapter.java
+++ b/services/core/java/com/android/server/display/LocalDisplayAdapter.java
@@ -16,6 +16,7 @@
 
 package com.android.server.display;
 
+import android.os.SystemProperties;
 import android.app.ActivityThread;
 import android.content.Context;
 import android.content.res.Resources;
@@ -567,7 +568,8 @@ final class LocalDisplayAdapter extends DisplayAdapter {
                 if (mDisplayInfo.isInternal) {
                     mInfo.type = Display.TYPE_INTERNAL;
                     mInfo.touch = DisplayDeviceInfo.TOUCH_INTERNAL;
-                    mInfo.flags |= DisplayDeviceInfo.FLAG_ROTATES_WITH_CONTENT;
+                    if (!SystemProperties.getBoolean("persist.test.my.del_rotation_flag", false))
+                        mInfo.flags |= DisplayDeviceInfo.FLAG_ROTATES_WITH_CONTENT;
                     mInfo.name = res.getString(
                             com.android.internal.R.string.display_manager_built_in_display_name);
                 } else {
diff --git a/services/core/java/com/android/server/wm/DisplayRotation.java b/services/core/java/com/android/server/wm/DisplayRotation.java
old mode 100644
new mode 100755
index 1284e009ee3f..5be49fd45bde
--- a/services/core/java/com/android/server/wm/DisplayRotation.java
+++ b/services/core/java/com/android/server/wm/DisplayRotation.java
@@ -837,6 +837,10 @@ public class DisplayRotation {
     }
 
     boolean isFixedToUserRotation() {
+        int t  = SystemProperties.getInt("persist.test.my.is_fixed_to_user_rotation", -1);
+        if ( t != -1  ){
+            return t > 0 ;
+        }
         switch (mFixedToUserRotation) {
             case IWindowManager.FIXED_TO_USER_ROTATION_DISABLED:
                 return false;
-- 
2.33.1

